version: '3.8'

services:
  # The Redis "message board" service
  redis:
    image: "redis:alpine"
    container_name: vulcan-redis

  # Our existing API service
  api:
    build: .
    container_name: vulcan-api
    ports:
      - "5000:5000"
    depends_on:
      - redis
    # Grant Nmap permissions here instead of in the run command
    cap_add:
      - NET_RAW
      - NET_ADMIN

  # The new Celery background worker service
  worker:
    build: .
    container_name: vulcan-worker
    # This runs the celery worker command instead of the gunicorn server
    command: celery -A tasks.celery_app worker --loglevel=info
    depends_on:
      - redis