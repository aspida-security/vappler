import React, { useState } from 'react';
import Icon from '../../../components/AppIcon';
import Button from '../../../components/ui/Button';
import Select from '../../../components/ui/Select';

const VulnerabilityActions = ({ selectedCount, onAction }) => {
  const [showExportOptions, setShowExportOptions] = useState(false);
  const [showAssignModal, setShowAssignModal] = useState(false);

  const exportOptions = [
    { value: 'pdf', label: 'PDF Report', icon: 'FileText' },
    { value: 'csv', label: 'CSV Data', icon: 'Table' },
    { value: 'json', label: 'JSON Export', icon: 'Code' },
    { value: 'xml', label: 'XML Export', icon: 'FileCode' }
  ];

  const assigneeOptions = [
    { value: 'john-doe', label: 'John Doe', description: 'Senior Security Analyst' },
    { value: 'jane-smith', label: 'Jane Smith', description: 'Vulnerability Researcher' },
    { value: 'mike-johnson', label: 'Mike Johnson', description: 'Security Engineer' },
    { value: 'sarah-wilson', label: 'Sarah Wilson', description: 'Penetration Tester' }
  ];

  const statusOptions = [
    { value: 'open', label: 'Open', description: 'Newly discovered vulnerability' },
    { value: 'in-progress', label: 'In Progress', description: 'Currently being addressed' },
    { value: 'resolved', label: 'Resolved', description: 'Vulnerability has been fixed' },
    { value: 'false-positive', label: 'False Positive', description: 'Not a real vulnerability' },
    { value: 'accepted-risk', label: 'Accepted Risk', description: 'Risk acknowledged but accepted' }
  ];

  const handleExport = (format) => {
    onAction('export', { format });
    setShowExportOptions(false);
  };

  const handleStatusChange = (status) => {
    onAction('change-status', { status });
  };

  const handleAssign = (assignee) => {
    onAction('assign', { assignee });
    setShowAssignModal(false);
  };

  const handleGenerateReport = () => {
    onAction('generate-report');
  };

  const handleExploitSearch = () => {
    onAction('exploit-search');
  };

  if (selectedCount === 0) {
    return (
      <div className="bg-card border border-border rounded-lg p-6">
        <div className="text-center py-8">
          <Icon name="MousePointer" size={48} className="text-muted-foreground mx-auto mb-4" />
          <h3 className="text-lg font-medium text-foreground mb-2">No Vulnerabilities Selected</h3>
          <p className="text-muted-foreground mb-4">
            Select one or more vulnerabilities to perform bulk actions
          </p>
          <div className="flex flex-wrap justify-center gap-2">
            <Button
              variant="outline"
              size="sm"
              onClick={handleGenerateReport}
              iconName="FileText"
              iconPosition="left"
            >
              Generate Full Report
            </Button>
            <Button
              variant="outline"
              size="sm"
              onClick={handleExploitSearch}
              iconName="Search"
              iconPosition="left"
            >
              Search Exploits
            </Button>
          </div>
        </div>
      </div>
    );
  }

  return (
    <div className="bg-card border border-border rounded-lg p-6">
      <div className="flex items-center justify-between mb-4">
        <div className="flex items-center space-x-3">
          <Icon name="Settings" size={20} className="text-muted-foreground" />
          <h3 className="text-lg font-semibold text-foreground">Bulk Actions</h3>
          <span className="text-sm text-muted-foreground">
            {selectedCount} vulnerabilities selected
          </span>
        </div>
        <Button
          variant="ghost"
          size="sm"
          onClick={() => onAction('clear-selection')}
          iconName="X"
          iconPosition="left"
          className="text-muted-foreground hover:text-foreground"
        >
          Clear Selection
        </Button>
      </div>
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
        {/* Status Change */}
        <div className="space-y-2">
          <label className="text-sm font-medium text-foreground">Change Status</label>
          <Select
            id="selectActionStatusId"
            options={statusOptions}
            placeholder="Select status..."
            onChange={handleStatusChange}
            className="w-full bg-background text-foreground border-border [&>button]:bg-background [&>button]:text-foreground [&>button]:border-border"
          />
        </div>

        {/* Assignment */}
        <div className="space-y-2">
          <label className="text-sm font-medium text-foreground">Assign To</label>
          <Select
            id="selectAssigneeId"
            options={assigneeOptions}
            placeholder="Select assignee..."
            onChange={handleAssign}
            searchable
            className="w-full bg-background text-foreground border-border [&>button]:bg-background [&>button]:text-foreground [&>button]:border-border"
          />
        </div>

        {/* Export Options */}
        <div className="space-y-2">
          <label className="text-sm font-medium text-foreground">Export Data</label>
          <div className="relative">
            <Button
              variant="outline"
              onClick={() => setShowExportOptions(!showExportOptions)}
              iconName="Download"
              iconPosition="left"
              className="w-full justify-start"
            >
              Export Selected
            </Button>
            {showExportOptions && (
              <>
                <div
                  className="fixed inset-0 z-40"
                  onClick={() => setShowExportOptions(false)}
                />
                <div className="absolute top-full left-0 right-0 mt-1 bg-popover border border-border rounded-lg shadow-elevation-lg z-50 py-2">
                  {exportOptions?.map((option) => (
                    <button
                      key={option?.value}
                      onClick={() => handleExport(option?.value)}
                      className="flex items-center space-x-3 w-full px-4 py-2 text-sm text-popover-foreground hover:bg-muted/50 transition-smooth"
                    >
                      <Icon name={option?.icon} size={16} />
                      <span>{option?.label}</span>
                    </button>
                  ))}
                </div>
              </>
            )}
          </div>
        </div>

        {/* Quick Actions */}
        <div className="space-y-2">
          <label className="text-sm font-medium text-foreground">Quick Actions</label>
          <div className="flex space-x-2">
            <Button
              variant="outline"
              size="sm"
              onClick={() => onAction('mark-resolved')}
              iconName="Check"
              className="flex-1"
            >
              Resolve
            </Button>
            <Button
              variant="outline"
              size="sm"
              onClick={() => onAction('mark-false-positive')}
              iconName="X"
              className="flex-1"
            >
              False +
            </Button>
          </div>
        </div>
      </div>
      {/* Additional Actions */}
      <div className="flex flex-wrap gap-3 mt-6 pt-4 border-t border-border">
        <Button
          variant="default"
          onClick={() => onAction('generate-report')}
          iconName="FileText"
          iconPosition="left"
        >
          Generate Report
        </Button>
        <Button
          variant="outline"
          onClick={() => onAction('schedule-scan')}
          iconName="Calendar"
          iconPosition="left"
        >
          Schedule Rescan
        </Button>
        <Button
          variant="outline"
          onClick={() => onAction('create-ticket')}
          iconName="Ticket"
          iconPosition="left"
        >
          Create Tickets
        </Button>
        <Button
          variant="outline"
          onClick={() => onAction('exploit-search')}
          iconName="Target"
          iconPosition="left"
          className="text-red-500 hover:text-red-600"
        >
          Search Exploits
        </Button>
      </div>
      {/* Action Summary */}
      <div className="mt-4 p-3 bg-muted/20 rounded-lg">
        <div className="flex items-center space-x-2 text-sm text-muted-foreground">
          <Icon name="Info" size={16} />
          <span>
            Actions will be applied to all {selectedCount} selected vulnerabilities. 
            Some actions may take a few moments to complete.
          </span>
        </div>
      </div>
    </div>
  );
};

export default VulnerabilityActions;